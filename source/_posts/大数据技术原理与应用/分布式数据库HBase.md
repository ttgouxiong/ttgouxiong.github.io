---
title: （四）分布式数据库HBase
date: 2020-12-26 13:53:27
tags: 大数据技术原理与应用
---

### 一. 概述

#### 1. 从BigTable说起
HBase是谷歌BigTable的开源实现，所以在这里先介绍BigTable。
BigTable是一个分布式存储系统，使用谷歌分布式系统GFS作为底层数据存储，起初用于解决典型的互联网搜索问题。
- 建立互联网索引：爬虫持续抓取新页面，这些页面每页一行存储到BigTable里面；MapReduce计算作业运行在整张表生成索引，为网络搜索应用做准备。
- 搜索互联网：用户发起网络搜索请求；网络搜索应用查询建立好的索引，从BigTable得到网页；搜索结果提交给用户。

#### 2. HBase简介
HBase是一个高可靠，高性能，面向列。可伸缩的分布式数据库，主要用来存储非结构化和半结构化的松散数据。HBase的目标是处理非常庞大的表，可以利用水平扩展的方式，利用廉价计算机集群处理超过10亿行数据和数百万列元素组成的数据表。
HBase和BigTable的底层技术对应关系：

|  | BigTable | HBase |
| :-----: | :-----: | :-----: |
| 文件存储系统 | GFS | HDFS |
| 海量数据处理 | MapReduce | Handoop MapReduce |
| 协同服务管理 | Chubby | Zookeeper |

有了关系数据库，并且Hadoop已经有了HDFS和MapReduce，为什么还需要HBase？
Hadoop可以很好的解决大规模数据的离线批量处理问题，但是，受限于Hadoop MapReduce编程框架的高延迟数据处理机制，使得Hadoop无法满足大规模数据实时处理应用的需求。传统的通用性关系数据库无法应对再数据规模急剧增长时导致的系统扩展性和性能问题（分库分表也不能很好的解决）。

HBase与传统关系型数据库的对比分析

||HBase|关系数据库
|:-----:|:-----:|:-----:
|数据类型|更加简单数据模型，把数据存储为未经解释的字符串（由操作人员解释）|关系模型，具有丰富的数据类型和存储方式|
|数据操作|不存在复杂表与表关系，只有简单插入，查询，删除|操作丰富，多表连接|
|存储模式|基于列存储，每个列族都由几个文件保存，不同列族的文件是分离的|基于行模式存储|
|数据索引|只有一个索引 —— 行键，通过巧妙设计，HBase中的所有访问方法，或者通过行键访问，扫描，从而使得系统不会慢下来|通常针对不同列构建复杂的多个索引，以提高数据访问性能|
|数据维护|生成数据新版本，旧版本保留|更新操作会用当前值替换记录中原有值，旧值被覆盖后不会存在|
|可伸缩性|分布式数据库就是为了实现灵活水平扩展而开发的，能够轻易通过在集群中增加或者减少硬件数量来实现性能的压缩|很难横向扩展，纵向扩展也比较有限|

#### 3. HBase访问接口
Native Java API, HBase Shell, Thrift Gateway, REST Gateway, Pig, Hive(数据仓库产品)

### 二. HBase数据模型

#### 1. 数据模型概述
- HBase是一个稀疏，多维度，排序的映射表，这张表的索引是行键，列族，列限定符和时间戳
- 每个值都是一个未经解释的字符串，没有数据类型
- 用户在表中存储数据，每一行都有一份可以排序的行键和任意多的列
- 表在水平方向由一个或者多个列族组成，一个列族中可以包含任意多个列，同一个列族里面的数据存储到一起
- 列族支持动态扩展，可以很轻松的添加一个列族或列，无需预先定义列的数量以及类型，所有列均已字符串形式存储，用户需要自行进行数据类型转换
- HBase中执行更新操作时，并不会删除数据旧的版本，而是生成新的版本，旧版本保留（这是和HDFS只允许追加不允许修改特性相关）
- 追求效率，有时候浪费点空间无所谓

#### 2. 数据模型相关概念

表；行；列族；列限定符；单元格（行，列族和列来确定）；时间戳
![](/images/大数据概述/数据模型.jpg)

#### 3. 数据坐标
一个单元格可以视为一个“四维坐标”：[行键，列族，列限定符，时间戳]

#### 4. 面向行与面向列存储优缺点
- 如果企业数据偏向事务性操作，推荐面向行存储，每一条数据信息全面完整，但是如果想对某一列数据进行分析则很不方便
- 如果企业数据偏向分析型操作，推荐面向列存储，每一列数据相似数据压缩率高，且便于分析

### 三. HBase的实现原理

#### 1. HBase功能组件
- 库函数：链接到每个客户端
- 一个Master主服务器：主服务器Master负责管理和维护HBase表的分区信息，维护Region服务器列表，分配Region，负载均衡
- 许多个Region服务器：Region服务器负责存储和维护分配给自己的Region，处理来自客户端的读写请求
客户端并不是直接从Master主服务器上读取数据，而是在获得Region的存储位置信息后，直接从Region服务器上读取数据
客户端并不依赖Master，而是通过Zookeeper来获得Region位置信息，大多数客户端甚至从来不和Master通信，这种设计方式使得Master负载很小

#### 2. 表和Region
一个HBase表被划分成很多个Region，开始只有一个Region，后来不断分裂，Region拆分操作非常快，接近瞬间，因为拆分之后的Region读取的仍是原存储文件，直到‘合并’过程把存储文件异步地写到独立的文件之后，才会读取新文件(只是修改指向)。

![](/images/大数据概述/三级寻址.jpg)
HBase的三层结构在各层次中的名称和作用(三层寻址)；

层次|名称|作用
:-----:|:-----:|:-----:
第一层|Zookeeper文件|记录了—ROOT-表的位置信息
第二层|-ROOT-表|记录了.META.表的Region位置信息 -ROOT-表只能由一个Region。通过-ROOT-表，就可以访问.META.表中的数据
第三层|.META.表|记录了用户数据表的Region位置信息，.META.表可以由有多个Region，保存了HABase中所有用户数据表的Region位置信息

为加快访问速度，.META.表的全部Region都会被保存在内存中。
客户端访问数据时的‘三级寻址’
- 为了加速寻址，客户端会缓存位置信息，同时，需要解决缓存失效的问题
- 寻址过程客户端只需要询问Zookeeper服务器，不需要链接Master服务器

### 四. HBase运行机制

#### 1. HBase系统架构

#### 2. Region服务器工作原理

#### 3. Store工作原理

#### 4. HLog工作原理



### 五. HBase应用方案

#### 1. HBase实际应用中的性能优化方法

#### 2. HBase性能监视

#### 3. 在HBase之上构建SQL引擎

#### 4. 构建HBase二级索引
