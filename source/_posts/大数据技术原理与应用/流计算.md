---
title: （十一）流计算
date: 2020-12-30 10:38:13
tags: 大数据技术原理与应用
---

### 一. 流计算概述

#### 1. 静态数据和流数据
静态数据：很多企业为了支持决策分析而构建的数据仓库系统，其中存放的大量历史数据就是静态数据。技术人员可以利用数据挖掘和OLAP（OnLine Analytical Processing）分析工具从静态数据中找到对企业有价值的信息。
流数据：近年来，在Web应用、网络监控、传感监测等领域，兴起了一种新的数据密集型应用——流数据，即数据以大量、快速、时变的流形式持续到达。实例：PM2.5检测、电子商务网站用户点击流
流数据具有如下特征：
- 数据快速持续到达，潜在大小也许是无穷无尽的
- 数据来源众多，格式复杂
- 数据量大，但是不十分关注存储，一旦经过处理，要么被丢弃，要么被归档存储
- 注重数据的整体价值，不过分关注个别数据
- 数据顺序颠倒，或者不完整，系统无法控制将要处理的新到达的数据元素的顺序

#### 2. 批量计算和实时计算
对静态数据和流数据的处理，对应着两种截然不同的计算模式：批量计算和实时计算
充裕时间处理静态数据，如Hadoop。流数据不适合采用批量计算，因为流数据不适合用传统的关系模型建模。流数据必须采用实时计算，响应时间为秒级。在大数据时代，数据格式复杂、来源众多、数据量巨大，对实时计算提出了很大的挑战。因此，针对流数据的实时计算——流计算，应运而生

#### 3. 流计算的概念
- 流计算：实时获取来自不同数据源的海量数据，经过实时分析处理，获得有价值的信息
- 流计算秉承一个基本理念，即数据的价值随着时间的流逝而降低，如用户点击流。因此，当事件出现时就应该立即进行处理，而不是缓存起来进行批量处理。为了及时处理流数据，就需要一个低延迟、可扩展、高可靠的处理引擎
- 对于一个流计算系统来说，它应达到如下需求：高性能，海量式，实时性，分布式，易用性，可靠性

#### 4. 流计算与Hadoop
Hadoop设计的初衷是面向大规模数据的批量处理。MapReduce是专门面向静态数据的批量处理的，内部各种实现机制都为批处理做了高度优化，不适合用于处理持续到达的动态数据。我们可能会想到一种“变通”的方案来降低批处理的时间延迟——将基于MapReduce的批量处理转为小批量处理，将输入数据切成小的片段，每隔一个周期就启动一次MapReduce作业。但这种方式也无法有效处理流数据
- 切分成小片段，可以降低延迟，但是也增加了附加开销，还要处理片段之间依赖关系
- 需要改造MapReduce以支持流式处理

**结论：鱼和熊掌不可兼得，Hadoop擅长批处理，不适合流计算**

#### 5. 流计算框架
当前业界诞生了许多专门的流数据实时计算系统来满足各自需求
- 商业级：IBM InfoSphere Streams和IBM StreamBase
- 开源流计算框架：
Twitter Storm：免费、开源的分布式实时计算系统，可简单、高效、可靠地处理大量的流数据
Yahoo! S4（Simple Scalable Streaming System）：开源流计算平台，是通用的、分布式的、可扩展的、分区容错的、可插拔的流式系统
- 公司为支持自身业务开发的流计算框架：
Facebook Puma
Dstream（百度）
银河流数据处理平台（淘宝）

### 二. 流计算处理流程
#### 1. 概述
传统的数据处理流程，需要先采集数据并存储在关系数据库等数据管理系统中，之后由用户通过查询操作和数据管理系统进行交互
传统的数据处理流程隐含了两个前提：
- 存储的数据是旧的。存储的静态数据是过去某一时刻的快照，这些数据在查询时可能已不具备时效性了
- 需要用户主动发出查询来获取结果

流计算的处理流程一般包含三个阶段：数据实时采集、数据实时计算、实时查询服务

#### 2. 数据实时采集
数据实时采集阶段通常采集多个数据源的海量数据，需要保证实时性、低延迟与稳定可靠。以日志数据为例，由于分布式集群的广泛应用，数据分散存储在不同
的机器上，因此需要实时汇总来自不同机器上的日志数据。目前有许多互联网公司发布的开源分布式日志采集系统均可满足每秒
数百MB的数据采集和传输需求，如：Facebook的Scribe，LinkedIn的Kafka，淘宝的Time Tunnel，基于Hadoop的Chukwa和Flume

数据采集系统的基本架构一般有以下三个部分：
- Agent：主动采集数据，并把数据推送到Collector部分
- Collector：接收多个Agent的数据，并实现有序、可靠、高性能的转发
- Store：存储Collector转发过来的数据（对于流计算不存储数据）

#### 3. 数据实时计算
- 数据实时计算阶段对采集的数据进行实时的分析和计算，并反馈实时结果
- 经流处理系统处理后的数据，可视情况进行存储，以便之后再进行分析计算。在时效性要求较高的场景中，处理之后的数据也可以直接丢弃

#### 4. 实时查询服务
- 实时查询服务：经由流计算框架得出的结果可供用户进行实时查询、展示或储存
- 传统的数据处理流程，用户需要主动发出查询才能获得想要的结果。而在流处理流程中，实时查询服务可以不断更新结果，并将用户所需的结果实时推送给用户
- 虽然通过对传统的数据处理系统进行定时查询，也可以实现不断地更新结果和结果推送，但通过这样的方式获取的结果，仍然是根据过去某一时刻的数据得到的结果，与实时结果有着本质的区别
可见，流处理系统与传统的数据处理系统有如下不同：
- 流处理系统处理的是实时的数据，而传统的数据处理系统处理的是预先存储好的静态数据
- 用户通过流处理系统获取的是实时结果，而通过传统的数据处理系统，获取的是过去某一时刻的结果
- 流处理系统无需用户主动发出查询，实时查询服务可以主动将实时结果推送给用户

### 三. 流计算的应用
流计算是针对流数据的实时计算，可以应用在多种场景中
- 如百度、淘宝等大型网站中，每天都会产生大量流数据，包括用户的搜索内容、用户的浏览记录等数据。采用流计算进行实时数据分析，可以了解每个时刻的流量变化情况，甚至可以分析用户的实时浏轨迹，从而进行实时个性化内容推荐
- 但是，并不是每个应用场景都需要用到流计算的。流计算适合于需要处理持续到达的流数据、对数据处理有较高实时性要求的场景

应用场景：
- 实时分析
- 实时交通

### 四. 开源流计算框架Storm

#### 1. Storm简介
以前只有政府机构和金融机构能够通过昂贵的定制系统来满足流数据实时分析计算需求.早期对于流计算的研究多数是基于对传统数据库处理的流式化，即实
时数据库，很少研究流计算框架。但是Yahoo! S4和Twitter Storm的开源，改变了这个情况。
在流数据处理上比MapReduce更有优势
批处理系统关注吞吐率，流处理系统关注延时
Yahoo! S4和Twitter Storm改变了开发实时应用的方式：
- 以前既要关注处理逻辑，还要解决实时数据获取、传输、存储
- 现在可以快速低成本搭建起实时流处理系统

Twitter Storm是一个免费、开源的分布式实时计算系统，Storm对于实时计算的意义类似于Hadoop对于批处理的意义，Storm可以简单、高效、可靠地处理流数据，并支持多种编程语言
Storm框架可以方便地与数据库系统进行整合，从而开发出强大的实时计算系统
![](/images/大数据概述/twitter.jpg)

#### 2. Storm的特点
Storm可用于许多领域中，如实时分析、在线机器学习、持续计算、远程RPC、数据提取加载转换等。Storm具有以下主要特点：
- 整合性
- 简易的API
- 可扩展性
- 可靠的消息处理
- 支持各种编程语言
- 快速部署
- 免费、开源

#### 3. Storm设计思想
Storm主要术语包括Streams、Spouts、Bolts、Topology和Stream Groupings（之后详细学习）

#### 4. Storm框架设计
（之后详细学习）

### 五. Spark Streaming

#### 1. Spark Streaming设计


#### 2. Spark Streaming与Storm的对比


### 六.Samza
#### 1. 基本概念

#### 2. 系统架构