---
title: （九）Hadoop再探讨
date: 2020-12-29 13:01:36
tags: 大数据技术原理与应用
---

### 一. Hadoop的优化与发展
#### 1. Hadoop的局限与不足
Hadoop1.0的核心组件（仅指MapReduce和HDFS，不包括Hadoop生态系统内的Pig、Hive、HBase等其他组件），主要存在以下不足：
- 抽象层次低，需人工编码
- 表达能力有限：像把操作简化成Map和Reduce，同时限制了表达能力，因为一些操作不能简单的用这两个过程代替
- 多个MapReduce作业形成工作流，Hadoop不能自身解决作业之间的这种依赖关系，需要开发者自己管理
- 难以看到程序整体逻辑
- 执行迭代操作效率低
- 资源浪费（Map和Reduce分两阶段执行）
- 实时性差（适合批处理，不支持实时交互式）

#### 2. 针对Hadoop的改进与提升
Hadoop的优化与发展主要体现在两个方面：
- 一方面是Hadoop自身两大核心组件MapReduce和HDFS的架构设计改进
- 另一方面是Hadoop生态系统其它组件的不断丰富，加入了Pig、Tez、Spark和Kafka等新组件

Hadoop框架自身的改进：从1.0到2.0

|组件| Hadoop1.0的问题| Hadoop2.0的改进|
|:----|:----|:----|
|HDFS|单一名称节点，存在单点失效的问题|设计了HDFS HA，提供名称节点热备机制|
|HDFS|单一命名空间，午发实现资源隔离|设计理HDFS Federation，管理多个命名空间|
|MapReduce|资源管理效率低|设计了新的资源管理框架YARN|

不断完善的Hadoop生态系统：
![](/images/大数据概述/Hadoop生态.jpg)

### HDFS2.0的新特性

#### 1. HDFS HA（High Availablity）
HDFS1.0存在单点故障问题，第二名称节点无法解决单点故障问题。
- SecondaryNameNode会定期和NameNode通信，从NameNode上获取到FsImage和EditLog文件，并下载到本地的相应目录下
- 执行EditLog和FsImage文件合并，将新的FsImage文件发送到NameNode节点上，NameNode使用新的FsImage和EditLog（缩小了）
第二名称节点用途：
- 不是热备份
- 主要是防止日志文件EditLog过大，导致名称节点失败恢复时消耗过多时间
- 附带起到冷备份功能

HA集群设置两个名称节点，“活跃（Active）”和“待命（Standby）”，两种名称节点的状态同步，可以借助于一个共享存储系统来实现。一旦活跃名称节点出现故障，就可以立即切换到待命名称节点。Zookeeper确保一个名称节点在对外服务。名称节点维护映射信息，数据节点同时向两个名称节点汇报信息。

#### 2. HDFS Federation
- HDFS1.0中存在的问题
单点故障问题
不可以水平扩展，因为只有一个名称节点不能再添加。也不能通过纵向扩展来解决，纵向扩展指加内存CPU，但是内存大会导致运行非常缓慢
系统整体性能受限于单个名称节点的吞吐量
单个名称节点难以提供不同程序之间的隔离性
HDFS HA是热备份，提供高可用性，但是无法解决可扩展性、系统性能和隔离性

- HDFS的设计 
在HDFS Federation中，设计了多个相互独立的名称节点，使得HDFS的命名服务能够水平扩展，这些名称节点分别进行各自命名空间和块的管理，相互之间是联盟（Federation）关系，不需要彼此协调。并且向后兼容
HDFS Federation中，所有名称节点会共享底层的数据节点存储资源，数据节点向所有名称节点汇报
属于同一个命名空间的块构成一个“块池”

- HDFS Federation的访问方式
对于Federation中的多个命名空间，可以采用客户端挂载表（Client SideMount Table）方式进行数据共享和访问
客户可以访问不同的挂载点来访问不同的子命名空间
把各个命名空间挂载到全局“挂载表”（mount-table）中，实现数据全局共享
同样的命名空间挂载到个人的挂载表中，就成为应用程序可见的命名空间

- HDFS Federation相对于HDFS1.0的优势
HDFS Federation设计可解决单名称节点存在的以下几个问题：
（1）HDFS集群扩展性。多个名称节点各自分管一部分目录，使得一个集群可以扩展到更多节点，不再像HDFS1.0中那样由于内存的限制制约文件存储数目
（2）性能更高效。多个名称节点管理不同的数据，且同时对外提供服务，将为用户提供更高的读写吞吐率
（3）良好的隔离性。用户可根据需要将不同业务数据交由不同名称节点管理，这样不同业务之间影响很小
需要注意的，HDFS Federation并不能解决单点故障问题，也就是说，每个名称节点都存在在单点故障问题，需要为每个名称节点部署一个后备名称节点，以应对名称节点挂掉对业务产生的影响

### 三. 新一代资源管理调度框架YARN
#### 1. MapReduce1.0的缺陷
- 存在单点故障
- JobTracker“大包大揽”导致任务过重（任务多时内存开销大，上限4000节点）
- 容易出现内存溢出（分配资源只考虑MapReduce任务数，不考虑CPU、内存）
- 资源划分不合理（强制划分为slot ，包括Map slot和Reduce slot）

#### 2. YARN设计思路
![](/images/大数据概述/YARN.jpg)

#### 3. YARN体系结构
- ResourseManager
- ApplicationMaseter
- NodeManager
(之后补上细节)

#### 4. YARN工作流程
(之后补上细节)

#### 5. YARN框架与MapReduce1.0框架的对比分析
(之后补上细节)

#### 6. YARN的发展目标
(之后补上细节)

### 四. Hadoop生态系统中具有代表性的功能组件

#### 1. Pig
- Pig是Hadoop生态系统的一个组件
- 提供了类似SQL的Pig Latin语言（包含Filter、GroupBy、Join、OrderBy等操作，同时也支持用户自定义函数）
- 允许用户通过编写简单的脚本来实现复杂的数据分析，而不需要编写复杂的MapReduce应用程序
- Pig会自动把用户编写的脚本转换成MapReduce作业在Hadoop集群上运行，而且具备对生成的MapReduce程序进行自动优化的功能
- 用户在编写Pig程序的时候，不需要关心程序的运行效率，这就大大减少了用户编程时间
- 通过配合使用Pig和Hadoop，在处理海量数据时就可以实现事半功倍的效果，比使用Java、C++等语言编写MapReduce程序的难度要小很多，并且用更少的代码量实现了相同的数据处理分析功能

Pig可以加载数据、表达转换数据以及存储最终结果
Pig语句通常按照如下的格式来编写:
- 通过LOAD语句从文件系统读取数据
- 通过一系列“转换”语句对数据进行处理
- 通过一条STORE语句把处理结果输出到文件系统中，或者使用DUMP语句把处理结果输出到屏幕上

Pig的应用场景
- 数据查询只面向相关技术人员
- 即时性的数据处理需求，这样可以通过pig很快写一个脚本开始运行处理，而不需要创建表等相关的事先准备工作

#### 2. Tez
Tez是Apache开源的支持DAG作业的计算框架，它直接源于MapReduce框架.核心思想是将Map和Reduce两个操作进一步拆分,Map被拆分成Input、Processor、Sort、Merge和Output,Reduce被拆分成Input、Shuffle、Sort、Merge、Processor和Output等。分解后的元操作可以任意灵活组合，产生新的操作，这些操作经过一些控制程序组装后，可形成一个大的DAG作业，通过DAG作业的方式运行MapReduce作业，提供了程序运行的整体处理逻辑，就可以去除工作流当中多余的Map阶段，减少不必要的操作，提升数据处理的性能。Hortonworks把Tez应用到数据仓库Hive的优化中，使得性能提升了约100倍。

在Hadoop2.0生态系统中，MapReduce、Hive、Pig等计算框架，都需要最终以MapReduce任务的形式执行数据分析，因此，Tez框架可以发挥重要的作用。借助于Tez框架实现对MapReduce、Pig和Hive等的性能优化。可以解决现有MR框架在迭代计算（如PageRank计算）和交互式计算方面的问题。

(Tez+Hive)与Impala、Dremel和Drill的区别？
（过后补上~）

#### 3. Spark
- Hadoop缺陷：其MapReduce计算模型延迟过高，无法胜任实时、快速计算的需求，因而只适用于离线批处理的应用场景
中间结果写入磁盘，每次运行都从磁盘读数据
在前一个任务执行完成之前，其他任务无法开始，难以胜任复杂、多阶段的计算任务

- Spark最初诞生于伯克利大学的APM实验室，是一个可应用于大规模数据处理的快速、通用引擎，如今是Apache软件基金会下的顶级开源项目之一
- Spark在借鉴Hadoop MapReduce优点的同时，很好地解决了MapReduce所面临的问题
内存计算，带来了更高的迭代运算效率
基于DAG的任务调度执行机制，优于MapReduce的迭代执行机制

- 当前，Spark正以其结构一体化、功能多元化的优势，逐渐成为当今大数据领域最热门的大数据计算平台

#### 4. Kafka

- Kafka是一种高吞吐量的分布式发布订阅消息系统，用户通过Kafka系统可以发布大量的消息，同时也能实时订阅消费消息
- Kafka可以同时满足在线实时处理和批量离线处理
- 在公司的大数据生态系统中，可以把Kafka作为数据交换枢纽，不同类型的分布式系统（关系数据库、NoSQL数据库、流处理系统、批处理系统等），可以统一接入到Kafka，实现和Hadoop各个组件之间的不同类型数据的实时高效交换